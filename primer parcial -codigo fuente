#include <stdio.h>
#include <string.h>

struct datos{
	char ti[100], au[50],an[50];
	
};

void inicializar(struct datos *pl);
void menu(void);
void agregar_libros(struct datos *pl);
void mostrar_libro(struct datos *pl);
void lista_libros(struct datos *pl);
void buscar_titulo(struct datos *pl);
void buscar_autor(struct datos *pl);
void buscar_ano(struct datos *pl);

int main (){
	
	int op;
	int pos=0;
	int i,j=0;
	struct datos libro[50];
	char a;
	FILE *archivo;
	
	printf("\n\t\tBiblioteca\n\n");
	
	inicializar(&libro[0]); 
	do{
		do{
			
			menu();
			scanf("%d",&op); 
			
			while(getchar() != '\n' && op != EOF);// Limpia buffer
			
			switch(op){
			case 1 : //Ingresar libro
				agregar_libros(&libro[pos]);
				pos++;
				break;
			case 2: //lista de libros
				lista_libros(&libro[0]);
				break;
			case 3 : //Busca en la lista por titulo
				buscar_titulo(&libro[0]);
				break;
			case 4 : //Busca en la lista por autor
				buscar_autor(&libro[0]);
				break;
			case 5 : //Busca en la lista por año
				buscar_ano(&libro[0]);
				break;
			case 6 : //Borra lista
				inicializar(&libro[0]);
				printf("\n\tLista borrada\n");
				break;
			case 7 : 
				archivo = fopen("datos.txt","w");
				if(archivo!=NULL){
					for (int i=0;i<50;i++){
						if(libro[i].ti[0]!='0'){
							fputs(libro[i].ti, archivo);
							fputc(',', archivo);
							fputs("\n",archivo);
							fputs(libro[i].au, archivo);
							fputc(',', archivo);
							fputs("\n",archivo);
							fputs(libro[i].an, archivo);
							fputs("\n",archivo);
						}
					}
					printf("\n\tDatos guardados\n");
				}
				else{
					printf("\n\tProblemas al abrir\n");
				}
				fclose(archivo);
				break;
			case 8 :
				archivo = fopen("datos.txt","r");
				if(archivo!=NULL){
					for(i=0;i<50;i++){
						j=0;
						while((a=fgetc(archivo))!=EOF&&a!=','){
							libro[i].ti[j]=a;
							j++;
						}
						libro[i].ti[j]='\0';
						
						j=0;
						while((a=fgetc(archivo))!=EOF&&a!=','){
							libro[i].au[j]=a;
							j++;
						}
						libro[i].au[j]='\0';
						
						j=0;
						while((a=fgetc(archivo))!=EOF&&a!=','){
							libro[i].an[j]=a;
							j++;
						}
						libro[i].an[j]='\0';
						
						
						
						fscanf(archivo,"%c",&a);
						
						fscanf(archivo,"%c",&a);
						
						fscanf(archivo,"%c",&a);
						
					}
					printf("\n\tDatos cargados\n");
				}
				else{
					printf("\n\tProblemas al abrir\n");
				}
				fclose(archivo);
				break;
			case 0 : 
				printf("\n\tSaliendo\n");
				break;
			default:
				printf("\n\tOpción incorrecta, reingrese opción\n");	
				break;
			}
		} while(op<0&&op>8);
	} while(op!=0);
}


void inicializar(struct datos *pl){  // inicializo en 0
	for(int i=0;i<50;i++){ //borra dasura 
		strcpy((*pl).ti,"0");
		strcpy((*pl).au,"0");
		strcpy((*pl).an,"0");
		pl++;
	}
}

void menu(void){
	printf("\nIngrese una opción:   \n");
	printf("\n1 Ingresar libro\n ");
	printf("\n2 Mostrar lista de libros\n ");
	printf("\n3 Buscar titulo de libro\n ");
	printf("\n4 Buscar autor del libro\n ");
	printf("\n5 Buscar año del libro\n ");
	printf("\n6 Borrar lista\n");
	printf("\n7 Guardar lista de libros\n");
	printf("\n8 Cargar lista de libros\n");
	printf("\n9 Buscar libro en el archivo (titulo-autor ó año)\n");
	printf("\n0 Salir");
	printf("\n\n\t");
}
void agregar_libros(struct datos *pl){ //agregar libros
	printf("\n\tTitulo: ");	
	gets((*pl).ti);
	printf("\tAutor: ");	
	gets((*pl).au);
	printf("\tAño: ");	
	gets((*pl).an);
}
void mostrar_libro(struct datos *pl){	//muestra libro con sus datos
	printf("\tTitulo: ");
	puts((*pl).ti);
	printf("\tAutor: ");
	puts((*pl).au);
	printf("\tAño: ");
	puts((*pl).an);
}
void lista_libros(struct datos *pl){ //lista con los libros
	printf("\n\t\tLista de libros:\n\n");
	for(int i=0;i<3;i++){
		mostrar_libro(pl);
		pl++;
	}
}
void buscar_titulo(struct datos *pl){ //busqueda a traves del titulo
	int aux1=1;
	char t[50];
	printf("\n\tTitulo del libro que busca:  ");
	gets(t);
	for(int i=0;i<50;i++){ 
		aux1=strcmp(t,(*pl).ti);
		if (aux1==0){
			mostrar_libro(pl);
			i=50;
		}
		pl++;
	}
	if (aux1==1){
		printf("\n\tLibro no disponible\n");
	}
}
void buscar_autor(struct datos *pl){ //busqueda a traves del autor
	int aux2=1;
	char a[50];
	printf("\n\tAutor del libro que busca:  ");
	gets(a);
	for(int i=0;i<50;i++){ 
		aux2=strcmp(a,(*pl).au);
		if (aux2==0){
			mostrar_libro(pl);
			i=50;
		}
		pl++;
	}
	if (aux2==1){
		printf("\n\tLibro no disponible\n");
	}
}
	void buscar_ano(struct datos *pl){ //busqueda a traves del año
		int aux3=1;
		char n[50];
		printf("\n\tAño del libro que busca:  ");
		gets(n);
		for(int i=0;i<50;i++){ 
			aux3=strcmp(n,(*pl).an);
			if (aux3==0){
				mostrar_libro(pl);
				i=50;
			}
			pl++;
		}
		if (aux3==1){
			printf("\n\tLibro no disponible\n");
		}
	}
